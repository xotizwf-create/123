<div class="auth-modal-v2" id="authModal" aria-hidden="true">
  <div class="auth-modal-v2__overlay" data-auth-close></div>
  <div class="auth-modal-v2__content">
    <button class="auth-modal-v2__close" data-auth-close aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
    
    <div class="auth-track-v2" id="authTrack">
      <!-- –í—Ö–æ–¥ (Login) -->
      <div class="auth-view" id="authViewLogin">
        <div class="auth-modal-v2__logo">–ü</div>
        <h2>–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º</h2>
        <p class="auth-subtitle">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É</p>
        
        <form class="auth-form-v2" id="loginForm">
          <div class="auth-field">
            <label for="loginEmail">–õ–û–ì–ò–ù</label>
            <div class="auth-input-wrapper">
              <span class="auth-input-icon">üìß</span>
              <input type="email" id="loginEmail" name="email" placeholder="user@prostavki.com" required>
            </div>
          </div>
          
          <div class="auth-field">
            <label for="loginPassword">–ü–ê–†–û–õ–¨</label>
            <div class="auth-input-wrapper">
              <span class="auth-input-icon">üîí</span>
              <input type="password" id="loginPassword" name="password" placeholder="********" required>
            </div>
          </div>
          
          <div class="auth-links">
            <a href="#" class="auth-link-forgot">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
          </div>
          
          <button type="submit" class="auth-submit-v2" id="submitLogin">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
          
          <div class="auth-divider-v2">
            <span>–∏–ª–∏</span>
          </div>
          
          <button type="button" class="auth-telegram-v2">
            <div class="tg-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="width: 14px; height: 14px;">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </div>
            –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram
          </button>
          
          <div class="auth-footer-v2">
            –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" class="auth-link-register" id="toRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
          </div>
        </form>
      </div>

      <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (Register) -->
      <div class="auth-view" id="authViewRegister" style="display: none;">
        <div class="auth-modal-v2__logo">–ü</div>
        <h2>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
        <p class="auth-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
        
        <div class="auth-options-v2">
          <button type="button" class="auth-btn-email-v2">
            <span class="btn-icon-v2">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 18px; height: 18px;">
                <path d="M4 4h16c1.1 0 2 0.9 2 2v12c0 1.1-0.9 2-2 2H4c-1.1 0-2-0.9-2-2V6c0-1.1 0.9-2 2-2z"></path>
                <polyline points="22,6 12,13 2,6"></polyline>
              </svg>
            </span>
            –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ Email
          </button>
          
          <button type="button" class="auth-btn-telegram-v2">
            <div class="tg-icon-white">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px;">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </div>
            –ß–µ—Ä–µ–∑ Telegram
          </button>
        </div>
        
        <div class="auth-footer-v2">
          –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" class="auth-link-login" id="toLogin">–í–æ–π—Ç–∏</a>
        </div>
      </div>

      <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Verification) -->
      <div class="auth-view" id="authViewVerification" style="display: none;">
        <div class="otp-hero-v2">
          <div class="otp-pulse"></div>
          <div class="otp-icon-v2">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 24px; height: 24px;">
              <path d="M4 4h16c1.1 0 2 0.9 2 2v12c0 1.1-0.9 2-2 2H4c-1.1 0-2-0.9-2-2V6c0-1.1 0.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
            <div class="otp-success-badge">‚úì</div>
          </div>
        </div>
        
        <h2 class="verify-title">–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
        <p class="auth-subtitle">–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ <br><span id="displayEmail" style="color: white; font-weight: 700;">user@prostavki.com</span></p>
        
        <div class="otp-inputs-v2">
          <input type="text" maxlength="1" inputmode="numeric" class="otp-field-v2">
          <input type="text" maxlength="1" inputmode="numeric" class="otp-field-v2">
          <input type="text" maxlength="1" inputmode="numeric" class="otp-field-v2">
          <input type="text" maxlength="1" inputmode="numeric" class="otp-field-v2">
          <input type="text" maxlength="1" inputmode="numeric" class="otp-field-v2">
          <input type="text" maxlength="1" inputmode="numeric" class="otp-field-v2">
        </div>
        
        <button type="button" class="auth-submit-v2" style="margin-top: 1.5rem;" onclick="window.location.href='/app'">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—Ö–æ–¥</button>
        
        <div class="otp-timer-v2">
          <span class="timer-icon">üïí</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ —á–µ—Ä–µ–∑ <span id="timerCount">00:59</span>
        </div>
        
        <button type="button" class="btn-back-v2" id="backToLogin">
          <span>‚Üê</span> –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('authModal');
    const triggers = document.querySelectorAll('[data-auth-trigger]');
    const closeBtns = document.querySelectorAll('[data-auth-close]');
    const views = {
      login: document.getElementById('authViewLogin'),
      register: document.getElementById('authViewRegister'),
      verify: document.getElementById('authViewVerification')
    };
    const loginForm = document.getElementById('loginForm');
    const displayEmail = document.getElementById('displayEmail');
    const timerCount = document.getElementById('timerCount');
    const otpInputs = document.querySelectorAll('.otp-field-v2');
    
    let timerInterval;

    const startTimer = () => {
      clearInterval(timerInterval);
      let seconds = 59;
      timerCount.textContent = `00:${seconds}`;
      timerInterval = setInterval(() => {
        seconds--;
        timerCount.textContent = `00:${seconds < 10 ? '0' + seconds : seconds}`;
        if (seconds <= 0) clearInterval(timerInterval);
      }, 1000);
    };

    const showView = (viewName) => {
      Object.values(views).forEach(v => {
        v.style.display = 'none';
        v.classList.remove('view-enter');
      });
      const targetView = views[viewName];
      targetView.style.display = 'block';
      
      if (viewName === 'verify') {
        targetView.classList.add('view-enter');
        startTimer();
        otpInputs[0].focus();
      }
    };

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      displayEmail.textContent = email;
      
      const submitBtn = document.getElementById('submitLogin');
      submitBtn.style.opacity = '0.7';
      submitBtn.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
      
      setTimeout(() => {
        submitBtn.style.opacity = '1';
        submitBtn.textContent = '–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É';
        showView('verify');
      }, 500);
    });

    document.getElementById('toRegister').onclick = (e) => { e.preventDefault(); showView('register'); };
    document.getElementById('toLogin').onclick = (e) => { e.preventDefault(); showView('login'); };
    document.getElementById('backToLogin').onclick = (e) => { e.preventDefault(); showView('login'); };

    triggers.forEach(btn => btn.addEventListener('click', (e) => {
      e.preventDefault();
      const view = btn.getAttribute('data-auth-trigger');
      modal.classList.add('is-active');
      showView(view === 'register' ? 'register' : 'login');
    }));
    
    closeBtns.forEach(btn => btn.addEventListener('click', () => modal.classList.remove('is-active')));

    otpInputs.forEach((input, idx) => {
      input.addEventListener('input', (e) => {
        if (e.target.value && otpInputs[idx + 1]) otpInputs[idx + 1].focus();
      });
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && !e.target.value && otpInputs[idx - 1]) otpInputs[idx - 1].focus();
      });
    });
  });
</script>
